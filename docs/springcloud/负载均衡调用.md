# 负载均衡调用

### 框架

- Spring Cloud Ribbon（进入维护模式，使用SpringCloud LoadBalance替代）: 基于Netflix Ribbon 实现的客户端负载均衡工具
- Feign：声明式web服务客户端，使得编写http客户端更加容易（Ribbon 需要使用RestTemplate发起Http请求）
- 

### 负载均衡

> 将用户请求平摊到多个服务上，从而达到HA（高可用）
> 常用的负载均衡软件：Nginx，

#### Ribbon与Nginx 的区别
 
 - Rinnon （进程式LB）集成到消费方进程内，由消费方从注册中心获取服务列表，选择哪个服务调用
 - Nginx（集中式LB）独立在服务消费方和提供方，通过特殊策略把消费方请求转发到提供方

## Ribbon集成（Ribbon不能放到统一父包（@ComponentScan所扫描的包）下，否者所有Ribbon客户端将都会使用此配置
1. pom引入
> 如果是在Eureka的基础上就不用引入（Eureka内部已经集成Ribbon）

2. 引入规则

```
//要配置在主启动（xxxApplication）上级目录
@Configuration
public class MyRule {
    @Bean
    public IRule myRule() {
        return new RandomRule();
    }
}

```

3. RestTemplate开启负载均衡

```
@Configuration
public class ApplicationContextConfig {

    @Bean
    @LoadBalanced //开启负载均衡
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
```
4. 启用Robin规则：主启动开启Robin

```
@EnableEurekaClient  //启用Eureka
//@EnableDiscoveryClient
@RibbonClient(name = "CLOUD-PROVIDER-PAYMENT",configuration = MySelfRule.class) //启用Ribbon客户端
public class ConsumerOrder80 {
    public static void main(String[] args) {
        SpringApplication.run(ConsumerOrder80.class,args);
    }

}
```

5. 


